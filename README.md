# Работа с сервером. REST-сервисы

## Изучение REST API через Swagger

Задача этого занятия – разобраться с протоколом REST и научиться работать с REST через интерфейс `Swagger`.

Для этого перейдите в папку RestServer и запустите сервер командой

```shell
java -jar RestServer.jar
```

> У вас должен быть установлен JDK! Если его нет,
> скачайте [с официального сайта](https://www.oracle.com/java/technologies/downloads/) и установите

Подождите, пока сервер запустится.
<details>
<summary>Опциональные технические детали</summary>
После старта по адресу http://localhost:3333 будет запущен HAL Browser
для просмотра и выполнения REST запросов (работает как `HATEOAS`).
Однако, нашей основной документацией для выполнения запросов будет `Swagger`.
Также вы можете просматривать и изменять данные в базе данных – в нашем случае используется H2.
Для этого надо пойти по адресу http://localhost:3333/h2/
указать URL: `jdbc:h2:file:./employees_db`
Имя пользователя и пароль можно оставить как есть. Соединившись, слева мы увидим список таблиц, и в нем –
таблицы `EMPLOYEE` и `TASK`.
</details>

Наша задача сейчас – научиться взаимодействовать с сервером через REST API.

Для этого откройте [интерфейс Swagger](http://localhost:3333/swagger-ui.html)

- Перейдите в Employee Entity и попробуйте получить список всех сотрудников:
  `GET /employees`

- Далее получите информацию по одному отдельному сотруднику:
  `GET /employees/{id}`

- Добавьте нового сотрудника, введя его данные в формате JSON:
  `POST /employees`

- Снова получите список всех сотрудников.
- Убедитесь, что новый сотрудник был добавлен.
- Найдите сотрудника по имени, по фамилии:
  `GET /employees/search/findByNameSurnameManager`, `GET /employees/search/findBySurname`

- Обновите часть данных о сотруднике, используя `PATCH`.
- Установите менеджера для сотрудника.
- Замените данные о сотруднике полностью, используя `PUT`.
- Добавьте задачу для сотрудника.
- Получите список всех задач сотрудника.
- Найдите информацию о сотруднике и убедитесь, что информация о задаче также отображается.
- Добавьте новую задачу, установив сотрудника ответственным по указанной задаче.
- Найдите сотрудника, ответственного за указанную задачу:
  `GET /tasks/{id}/responsibleId`
- Измените сотрудника, ответственного за указанную задачу:
  `POST /tasks/{id}/responsibleId`

- Воспользуйтесь «поиском по образцу»:
  Найдите всех сотрудников, удовлетворяющих условиям, например с определенной фамилией и именем:
  `POST /employees/findByExample`

Как вы видите, нам доступны практически все возможные операции над сотрудниками и задачами.
Задача разработки пользовательского интерфейса – лишь сделать удобный интерфейс для работы с REST-сервисом. Чем мы и
будем заниматься.

## Работа через браузер

Теперь давайте попробуем получить данные, просто открывая страницы в браузере. Переход по URL – это и есть `GET`-запрос
к
серверу, поэтому с этим проблем возникнуть не должно. Например, если вы добавили сотрудника Петр Петров, вы легко можете
найти его, используя [такой URL](http://localhost:3333/employees/search/findByName?name=Петр) – просто откройте его в
браузере.
По фамилии – можно найти [так](http://localhost:3333/employees/search/findBySurname?surname=Петров).

Также [можно найти](http://localhost:3333/employees/search/findByNameSurnameManager?name=Петр&surname=Петров) по имени,
фамилии и id менеджера – то есть тем полям, которые мы вводим в строку поиска:
Обратите внимание, что мы здесь не указали `id` менеджера – любой из параметров опционален, и сервис ищет по тем
параметрам, которые мы указали.

Теперь мы в одном шаге от возможности получать данные программно.
Давайте откроем консоль и введем такой код:

```js
fetch(`http://localhost:3333/employees`)
    .then(res => res.json())
    .then(res => console.log(res._embedded.employees));
```

Вы увидите список сотрудников с именем Петр, выведенных в лог.

Можно также создавать и `POST`-запросы:

```js
fetch('http://localhost:3333/employees/findByExample', {
    method: 'post',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({name: 'Петр'})
})
    .then(res => res.json())
    .then(res => console.log(res));
```

Вот как, скажем, можно добавить нового сотрудника.
Допустим, у нас есть объект с данными сотрудника:

```js
const employee = {
    name: "Федор",
    surname: "Федоров"
};
fetch('http://localhost:3333/employees', {
    method: 'post',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(employee)
})
    .then(res => res.json())
    .then(res => console.log(res));
```

В качестве результата мы получим только что добавленный объект – и сможем, например, прочитать его `id`.

## Дополнительные задания

- Переведите интерфейс нашего приложения на работу с сервером.
